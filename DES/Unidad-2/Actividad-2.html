<div class="container my-5">
    <h1 class="mb-4 text-primary">Actividad 2.2: Instalación y Configuración de Nginx</h1>

    <h2 class="mb-4 text-primary">1. Instalación del servidor web Nginx</h2>
    <p>Para instalar Nginx en Debian, primero actualizamos los repositorios y después instalamos el paquete
        correspondiente:</p>
    <pre><code class="language-bash">#Actualizar los repositorios
sudo apt update
#sudo apt install (nombre)
sudo apt install nginx</code></pre>
    <div class="img-responsive text-center p-3">
        <img src="../DES/img/Unidad-2/instalacion-servidor.png" alt="Instalación Servidor" class="w-100">
    </div>
    <p>A continuación, comprobamos que Nginx se ha instalado y que está funcionando correctamente:</p>
    <pre><code class="language-bash">systemctl status nginx</code></pre>
    <div class="alert alert-info">
        <strong>Info:</strong> Esta actividad se ha realizado con la versión Nginx 1.22.0.
    </div>
    <div class="img-responsive text-center p-3">
        <img src="../DES/img/Unidad-2/status-nginx.png" alt="Server Status" class="w-100">
    </div>
    <h2 class="mb-4 text-primary">2. Creación de la estructura de directorios del sitio web</h2>
    <p>Al igual que en Apache, los archivos de un sitio web se organizan en directorios, típicamente dentro de
        <code>/var/www</code>. Crearemos la carpeta para nuestro sitio web:
    </p>
    <pre><code class="language-bash">sudo mkdir -p /var/www/nombre_web/html</code></pre>
    <p>Dentro de este nuevo directorio <code>html</code>, debéis clonar el siguiente repositorio de ejemplo:</p>
    <pre><code class="language-bash">sudo git clone https://github.com/cloudacademy/static-website-example.git /var/www/nombre_web/html</code></pre>
    <div class="alert alert-info" role="alert">
        <p>Si os da error <code>sudo: git: command not found</code>, simplemente hay que instalarlo
            <code>sudo apt install git</code>, después os recomiendo comprobar la versión <code>git --version</code>
        </p>
    </div>

    <p>Después, asignamos la propiedad de estos directorios al usuario <code>www-data</code>, que es el usuario con el
        que se ejecuta el servicio web:</p>
    <pre><code class="language-bash">sudo chown -R www-data:www-data /var/www/nombre_web/html</code></pre>
    <p>Finalmente, ajustamos los permisos para evitar errores de acceso:</p>
    <pre><code class="language-bash">sudo chmod -R 755 /var/www/nombre_web</code></pre>
    <div class="img-responsive text-center p-3">
        <img src="../DES/img/Unidad-2/creacion-estructura-directorios-web.png" alt="Server Status" class="w-100">
    </div>
    <h2 class="mb-4 text-primary">3. Configuración del <strong>Server Block</strong> en Nginx</h2>
    <p>En Nginx, las configuraciones de cada sitio se gestionan en los directorios <code>sites-available</code> (donde
        se guardan todas las configuraciones posibles) y <code>sites-enabled</code> (donde se activan mediante enlaces
        simbólicos).</p>
    <p>Vamos a crear un nuevo archivo de configuración (llamado "<strong>Server Block</strong>") para nuestro sitio en
        <code>/etc/nginx/sites-available/</code>:
    </p>
    <div class="alert alert-info" role="alert">
        <p><strong>Server Block:</strong> Es el nombre conceptual que Nginx le da a un bloque de configuración que
            define un sitio virtual. Es el contenido que va dentro del archivo, el código que empieza con server { y
            termina con }. Piensa en ello como una "receta".
        </p>
        <p><strong>nombre_web:</strong> Es el nombre del archivo que va a contener esa "receta". Es un placeholder, un
            ejemplo que te indica que debes reemplazarlo con el nombre real de tu sitio.</p>
    </div>
    <pre><code class="language-bash">sudo nano /etc/nginx/sites-available/nombre_web</code></pre>
    <p>Pega el siguiente contenido en el archivo. Este bloque le dice a Nginx cómo servir nuestro sitio:</p>
    <pre><code class="language-js">server {
    listen 80;
    listen [::]:80;

    root /var/www/nombre_web/html;
    index index.html index.htm;

    server_name nombre_web www.nombre_web;

    location / {
        try_files $uri $uri/ =404;
    }
}</code></pre>
    <div class="img-responsive text-center p-3">
        <img src="../DES/img/Unidad-2/server-block.png" alt="Server Status" class="w-100">
    </div>

    <p>Ahora, habilitamos el sitio creando un enlace simbólico desde <code>sites-available</code> a
        <code>sites-enabled</code>:
    </p>
    <pre><code class="language-bash">sudo ln -s /etc/nginx/sites-available/nombre_web /etc/nginx/sites-enabled/</code></pre>
    <p>Por último, reiniciamos Nginx para que los cambios se apliquen:</p>
    <pre><code class="language-bash">sudo systemctl restart nginx</code></pre>

    <div class="img-responsive text-center p-3">
        <img src="../DES/img/Unidad-2/habilitar-sitio.png" alt="habilitar-sitio" class="w-100">
    </div>

    <div class="alert alert-info mt-4">
        <p>Imaginemos que ya tienes tu primer sitio (disenyo.com) configurado y funcionando. Ahora quieres añadir un
            segundo sitio (portfolio.com).<br>
            El proceso sería el siguiente:</p>
        <ol>
            <li>Preparar los archivos del nuevo sitio:<br>
                Primero, creas un nuevo directorio para los archivos del segundo sitio, completamente separado del
                primero.</li>
            <li>Crear un NUEVO archivo de configuración:<br>
                Ahora, creas un archivo de configuración completamente nuevo en sites-available para este segundo sitio.
            </li>
            <li>Escribir el NUEVO Server Block:<br>
                Dentro de este nuevo archivo, por ejemplo (portfolio.com), pegarás un nuevo server block que apunte a
                los recursos
                del segundo sitio. Fíjate en las directivas que cambian: server_name y root.</li>
            <li>Activar el nuevo sitio:<br>
                Al igual que hiciste con el primero, creas un enlace simbólico para activar este nuevo sitio y recargas
                Nginx.</li>
        </ol>
    </div>
    <h2 class="mb-4 text-primary">4. Comprobaciones</h2>
    <h3 class="mb-4 text-primary">4.1. Comprobación del correcto funcionamiento</h3>
    <p>Como aún no tenemos un servidor DNS, debemos modificar el archivo <code>hosts</code> de nuestra máquina
        <strong>local (anfitriona)</strong> para asociar el nombre de dominio a la IP de la máquina virtual.
    </p>
    <ul>
        <li>En Linux o macOS, el archivo es: <code>/etc/hosts</code></li>
        <li>En Windows, el archivo es: <code>C:\Windows\System32\drivers\etc\hosts</code></li>
    </ul>
    <p>Añade la siguiente línea al final del archivo:</p>
    <pre><code class="language-bash">#Recuera que si estás utilizando tu ordenador tendrás que comprobar la IP de tu servidor diariamente.
 #Ip Servidor cuando estés en casa
    192.168.X.X   nombre_web
    192.168.X.X   www.nombre_web
 #Ip Servidor cuando estés en otra red
    172.17.X.X nombre_web
    172.17.X.X www.nombre_web</code></pre>
    <div class="img-responsive text-center p-3">
        <img src="../DES/img/Unidad-2/editar-fichero-host-mac.png" alt="editar-fichero-host-mac" class="w-100">
    </div>
    <div class="alert alert-warning">
        <strong>¡Atención!</strong> Recuerda sustituir la IP por la de tu máquina virtual. Si usas un proveedor en la
        nube, esta IP puede cambiar cada vez que reinicies la instancia.
    </div>
    <p>Ahora, abre un navegador en tu máquina local y accede a <code>http://nombre_web</code>. Deberías ver el sitio web
        del repositorio clonado.</p>
    <div class="img-responsive text-center p-3">
        <img src="../DES/img/Unidad-2/pagina-web-ejemplo-servida-por-nginx.png"
            alt="Página web de ejemplo servida por Nginx" class="w-100">
    </div>

    <h3 class="mb-4 text-primary">4.2. Comprobar registros del servidor</h3>
    <p>Verifica que las peticiones se registran correctamente en los archivos de logs de Nginx:</p>
    <ul>
        <li><code><strong>/var/log/nginx/access.log</strong></code>: Registra todas las solicitudes correctas al
            servidor.</li>
        <li><code><strong>/var/log/nginx/error.log</strong></code>: Registra cualquier error que Nginx encuentre.</li>
    </ul>
    <div class="img-responsive text-center p-3">
        <img src="../DES/img/Unidad-2/comprobar-registros-servidor.png" alt="Página web de ejemplo servida por Nginx"
            class="w-100">
    </div>
    <div class="alert alert-info">
        Si no ves actividad en los logs, puede ser que el navegador haya cacheado la página. Usa el modo privado o de
        incógnito para forzar una nueva petición al servidor.
    </div>

    <h2 class="mb-4 text-primary">5. ¿Cómo sabe Nginx a qué sitio dirigir al usuario?</h2>
    <p>Cuando un visitante escribe http://portfolio.com en su navegador, ocurre lo siguiente:</p>
    <ol>
        <li>El navegador envía una petición a la dirección IP de tu servidor.
        </li>
        <li>Dentro de esa petición, hay una cabecera especial llamada Host, que dice: Host: portfolio.com.
        </li>
        <li>Nginx recibe la petición en el puerto 80. Mira la cabecera Host.
        </li>
        <li>Nginx busca entre todos sus "Server Blocks" activos (los de sites-enabled) cuál de ellos tiene una
            directiva
            server_name que coincida con portfolio.com.
        </li>
        <li>Al encontrar tu segundo server block, utiliza la configuración que está dentro de él (el root
            /var/www/portfolio.com/html) para servir el archivo correcto.</li>
    </ol>

    <h2 class="mb-4 text-primary">Cuestiones Finales</h2>
    <ol>
        <li>¿Qué pasa si no hago el enlace simbólico entre <code>sites-available</code> y <code>sites-enabled</code>
            de
            mi sitio web?</li>
        <li>¿Qué pasa si no le doy los permisos adecuados (<code>chown</code> y <code>chmod</code>) a la carpeta
            <code>/var/www/nombre_web</code>?
        </li>
    </ol>
</div>
