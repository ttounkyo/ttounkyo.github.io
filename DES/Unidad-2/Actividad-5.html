<div class="container my-5">
    <h1 class="mb-4 text-primary">Actividad 2.5. Seguridad Web con Let's Encrypt</h1>
    <p>En esta actividad, aseguraremos nuestro servidor web implementando el protocolo HTTPS. Utilizaremos <strong>Let's
            Encrypt</strong>, una autoridad de certificación gratuita, automatizada y abierta, para obtener un
        certificado SSL/TLS válido.</p>

    <div class="alert alert-info">
        Realizarás esta actividad sobre el servidor VPS en AWS que creaste en la
        <strong>Actividad 2.6</strong>.
    </div>

    <h2 class="mb-4 text-primary">Requisitos Previos</h2>
    <ul>
        <li>Tener tu servidor VPS de AWS (Debian) en funcionamiento (ver Actividad 2.6).</li>
        <li>Tener Nginx instalado y funcionando.</li>
        <li><strong>Dominio Asignado:</strong> Se te ha asignado un subdominio del tipo <code>nombre.ohmycats.net</code>
            (donde "nombre" es tu identificador). Este dominio ya apunta a la IP de tu servidor.</li>
    </ul>

    <h2 class="mb-4 text-primary">Paso 0: Configurar el Firewall de AWS (Security Groups)</h2>
    <p>Antes de empezar, es CRÍTICO asegurarse de que el firewall de Amazon permite el tráfico HTTPS. Por defecto, solo
        abrimos el puerto 80 (HTTP) y 22 (SSH).</p>
    <ol>
        <li>Ve a la consola de AWS EC2.</li>
        <li>Selecciona tu instancia y ve a la pestaña <strong>"Security"</strong> (Seguridad).</li>
        <li>Haz clic en tu <strong>Security Group</strong>.</li>
        <li>Haz clic en <strong>"Edit inbound rules"</strong> (Editar reglas de entrada).</li>
        <li>Añade una nueva regla:
            <ul>
                <li><strong>Type:</strong> HTTPS</li>
                <li><strong>Port:</strong> 443</li>
                <li><strong>Source:</strong> Anywhere-IPv4 (0.0.0.0/0)</li>
            </ul>
        </li>
        <li>Guarda los cambios.</li>
    </ol>
    <div class="img-responsive text-center p-3">
        <img src="../DES/img/Unidad-2/https.png" alt="Configurar https en AWS" class="w-75">
    </div>


    <h2 class="mb-4 text-primary">Paso 1: Preparar Nginx</h2>
    <p>Para que Certbot pueda validar tu dominio, Nginx debe estar configurado correctamente con tu nombre de dominio.
    </p>
    <ol>
        <li>Edita la configuración de tu sitio (por defecto en <code>/etc/nginx/sites-available/default</code> o el
            archivo que hayas creado).</li>
        <li>Busca la directiva <code>server_name</code> y asegúrate de que tiene tu dominio asignado:
            <pre><code class="language-nginx">server_name tu_nombre.ohmycats.net;</code></pre>
        </li>
        <li>Verifica que la configuración es correcta y recarga Nginx:
            <pre><code class="language-bash">sudo nginx -t
sudo systemctl reload nginx</code></pre>
        </li>
    </ol>

    <h2 class="mb-4 text-primary">Paso 2: Instalar Certbot</h2>
    <p>Instalaremos Certbot y su plugin para Nginx usando los repositorios oficiales de Debian:</p>
    <pre><code class="language-bash">sudo apt update
sudo apt install certbot python3-certbot-nginx</code></pre>

    <h2 class="mb-4 text-primary">Paso 3: Obtener el Certificado</h2>
    <p>Ejecuta Certbot. El plugin de Nginx se encargará de reconfigurar tu servidor automáticamente:</p>
    <pre><code class="language-bash">sudo certbot --nginx</code></pre>
    <p>Sigue las instrucciones en pantalla:</p>
    <ul>
        <li>Introduce tu correo electrónico (para avisos de renovación).</li>
        <li>Acepta los términos de servicio.</li>
        <li>Si te pregunta si quieres redirigir el tráfico HTTP a HTTPS, elige <strong>2: Redirect</strong> (o "Yes").
            Esto automatiza el Paso 5 de la actividad original.</li>
    </ul>

    <h2 class="mb-4 text-primary">Paso 4: Verificación</h2>
    <ol>
        <li>Abre tu navegador y entra en <code>https://tu_nombre.ohmycats.net</code>.</li>
        <li>Comprueba que aparece el candado cerrado al lado de la URL.</li>
        <li>Intenta entrar con <code>http://...</code> y verifica que te redirige automáticamente a
            <code>https://...</code>.
        </li>
    </ol>
    <!--

    <h2 class="mb-4 text-primary">Desafío 8: Proxy Inverso con Node.js y HTTPS</h2>
    <p>Ahora que tienes HTTPS, vamos a configurar Nginx para que proteja una aplicación interna.</p>
    <ol>
        <li><strong>Instala Node.js:</strong>
            <pre><code class="language-bash">sudo apt install nodejs npm</code></pre>
        </li>
        <li><strong>Crea la App:</strong> Crea una carpeta, inicia un proyecto (`npm init -y`) e instala Express (`npm
            install express`). Crea un archivo `app.js` que escuche en el puerto 3000.</li>
        <li><strong>Configura el Proxy en Nginx:</strong> Modifica tu bloque de servidor (que ahora tendrá la
            configuración SSL añadida por Certbot) para que la ubicación raíz `/` pase las peticiones a Node.js:
            <pre><code class="language-nginx">location / {
    proxy_pass http://localhost:3000;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_cache_bypass $http_upgrade;
}</code></pre>
        </li>
        <li>Recarga Nginx y accede a tu dominio. Deberías ver tu aplicación Node.js servida de forma segura a través de
            HTTPS.</li>
    </ol>

    <h2 class="mb-4 text-primary">Tareas Adicionales (Opcional)</h2>
    <h3 class="mb-4 text-primary">Certificados Autofirmados</h3>
    <p>Si no tuvieras un dominio público, podrías usar certificados autofirmados. Aunque el navegador mostrará una
        advertencia, el tráfico viajará cifrado.
        Investiga los comandos:
        <code>openssl req -x509 ...</code> para generar el certificado y la clave privada manualmente.
    </p>
-->
</div>
