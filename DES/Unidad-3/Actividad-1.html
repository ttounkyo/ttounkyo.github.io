<div class="container my-5">
    <h1 class="mb-4 text-primary">Actividad 3.1: Despliegue de aplicaciones con Node.js y Express</h1>

    <h2 class="mb-4 text-primary">Introducci√≥n</h2>
    <p>En esta actividad vamos a trabajar con <strong>Node.js</strong> y <strong>Express</strong>, dos tecnolog√≠as muy
        populares para crear aplicaciones web del lado del servidor.</p>

    <h4 class="mb-3 text-primary">¬øQu√© es Node.js?</h4>
    <p>Node.js es un entorno de ejecuci√≥n de JavaScript que nos permite ejecutar c√≥digo JavaScript fuera del navegador,
        directamente en el servidor. Es muy r√°pido y eficiente para manejar m√∫ltiples conexiones simult√°neas.</p>

    <h4 class="mb-3 text-primary">¬øQu√© es npm?</h4>
    <p><strong>npm</strong> (Node Package Manager) es el gestor de paquetes de Node.js. Nos permite instalar librer√≠as y
        herramientas que otros desarrolladores han creado, similar a <code class="language-bash">apt</code> en Debian
        pero para paquetes de
        JavaScript.</p>

    <h4 class="mb-3 text-primary">¬øQu√© es Express?</h4>
    <p><strong>Express</strong> es un framework minimalista para Node.js que nos facilita la creaci√≥n de servidores web
        y APIs. Simplifica tareas comunes como manejar rutas, peticiones HTTP y respuestas.</p>

    <div class="alert alert-info" role="alert">
        A diferencia de Apache o Nginx, en Node.js <strong>la aplicaci√≥n ES el servidor</strong>. No desplegamos nuestra
        aplicaci√≥n sobre un servidor web, sino que nuestra aplicaci√≥n incluye el servidor web integrado.
    </div>

    <h2 class="mb-4 text-primary">1. Instalaci√≥n y Configuraci√≥n</h2>

    <h3 class="mb-4 text-primary">1.1 Instalaci√≥n de Node.js y npm</h3>
    <p>Vamos a instalar Node.js y npm en nuestro servidor Debian. Sigue estos pasos:</p>

    <ol>
        <li>Primero, actualiza los repositorios del sistema:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">sudo apt update</code></pre>
            </div>
        </li>

        <li>Instala Node.js y npm (se instalan juntos):
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">sudo apt install -y nodejs npm</code></pre>
            </div>
            <div class="alert alert-info mt-2">
                La opci√≥n <code class="language-bash">-y</code> confirma autom√°ticamente la instalaci√≥n sin
                preguntarnos.
            </div>
        </li>

        <li>Verifica que la instalaci√≥n fue correcta comprobando las versiones instaladas:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">node --version
npm --version</code></pre>
            </div>
            Deber√≠as ver algo como:
            <pre><code class="language-bash">v20.19.2
9.2.0</code></pre>
            <div class="alert alert-info mt-2">
                Si ves las versiones, la instalaci√≥n fue exitosa, ten en cuenta que la versi√≥n puede variar.
            </div>
        </li>
    </ol>

    <div class="alert alert-warning" role="alert">
        <strong>üì∏ Tarea:</strong> Captura de pantalla mostrando las versiones de <code
            class="language-bash">node</code> y <code class="language-bash">npm</code>
        instaladas en tu sistema.
    </div>

    <h3 class="mb-4 text-primary">1.2 Instalaci√≥n de Express (globalmente)</h3>
    <p>Aunque Express normalmente se instala por proyecto, vamos a instalarlo globalmente para tener acceso al generador
        de aplicaciones:</p>

    <ol>
        <li>Instala Express de forma global:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">sudo npm install -g express express-generator</code></pre>
            </div>
            <div class="alert alert-info mt-2">
                <strong>Explicaci√≥n:</strong>
                <ul>
                    <li><code class="language-bash">-g</code> significa "global", instala el paquete para todo el
                        sistema</li>
                    <li><code class="language-bash">express-generator</code> es una herramienta que nos ayuda a crear
                        proyectos Express
                        r√°pidamente</li>
                    <li>
                        Si ves un mensaje npm WARN deprecated mkdirp@0.5.1 es solo una advertencia, no un error.
                        Significa que:
                        <ul>
                            <li>Express y express-generator se instalaron correctamente ("changed 75 packages in 3s")
                            </li>
                            <li>Una dependencia interna (mkdirp) usa una versi√≥n antigua</li>
                            <li>Los desarrolladores recomiendan actualizar, pero no afecta el funcionamiento</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </li>

        <li>Verifica la instalaci√≥n:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">express --version
# Posible resultado, la versi√≥n puede variar.
4.16.1
                </code></pre>
            </div>
        </li>
    </ol>

    <h2 class="mb-4 text-primary">2. Primera Aplicaci√≥n - "Hola Mundo"</h2>

    <h3 class="mb-4 text-primary">2.1 Crear y ejecutar tu primera aplicaci√≥n Node.js</h3>
    <p>Vamos a crear una aplicaci√≥n muy simple para entender los conceptos b√°sicos.</p>

    <ol>
        <li>Crea un directorio para tu primera aplicaci√≥n:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">mkdir ~/mi-primera-app
cd ~/mi-primera-app</code></pre>
            </div>
        </li>

        <li>Inicializa un proyecto Node.js. Este comando crear√° un archivo <code
                class="language-bash">package.json</code> que contiene
            informaci√≥n sobre tu proyecto:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">npm init -y</code></pre>
            </div>
            <div class="alert alert-info mt-2">
                El flag <code class="language-bash">-y</code> acepta todas las opciones por
                defecto. El archivo
                <code class="language-bash">package.json</code> es como el "DNI" de tu aplicaci√≥n.
            </div>
        </li>

        <li>Instala Express para este proyecto espec√≠fico:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">npm install express</code></pre>
            </div>
            Ver√°s que se crea una carpeta <code class="language-bash">node_modules</code> con todas las dependencias.
        </li>

        <li>Crea un archivo llamado <code class="language-bash">app.js</code> con el siguiente contenido:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">nano app.js</code></pre>
            </div>
            Escribe (o copia) este c√≥digo:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-javascript">const express = require('express');
const app = express();
const puerto = 3000;

app.get('/', (req, res) => {
  res.send('¬°Hola Mundo desde Express!');
});

app.listen(puerto, () => {
  console.log(`Servidor corriendo en http://localhost:${puerto}`);
});</code></pre>
                Guarda el archivo (Ctrl+O, Enter, Ctrl+X).

                <div class="alert alert-info mt-3">
                    <strong>Explicaci√≥n del c√≥digo:</strong>
                    <ul>
                        <li><code class="language-bash">require('express')</code> importa la librer√≠a Express</li>
                        <li><code class="language-bash">app.get('/', ...)</code> define qu√© hacer cuando alguien visita
                            la ra√≠z del sitio</li>
                        <li><code class="language-bash">app.listen(3000)</code> inicia el servidor en el puerto 3000
                        </li>
                    </ul>
                </div>
        </li>

        <li>Ejecuta la aplicaci√≥n:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">node app.js</code></pre>
            </div>
            Deber√≠as ver el mensaje: <code class="language-bash">Servidor corriendo en http://localhost:3000</code>
        </li>

        <li>Desde tu navegador en tu m√°quina local, accede a:
            <pre><code class="language-bash">http://IP-DE-TU-SERVIDOR:3000</code></pre>
            Deber√≠as ver el mensaje "¬°Hola Mundo desde Express!"
        </li>
    </ol>

    <div class="alert alert-warning" role="alert">
        <strong>üîí Seguridad AWS:</strong> Si est√°s usando AWS, recuerda abrir el puerto 3000 en tu grupo de seguridad:
        <ul>
            <li>Tipo: TCP personalizado</li>
            <li>Puerto: 3000</li>
            <li>Origen: 0.0.0.0/0 (o tu IP espec√≠fica para mayor seguridad)</li>
        </ul>
    </div>

    <div class="alert alert-warning" role="alert">
        <strong>üì∏ Tarea:</strong> Captura de pantalla mostrando:
        <ul>
            <li>La terminal con el servidor corriendo (<code class="language-bash">node app.js</code>)</li>
            <li>El navegador mostrando "¬°Hola Mundo desde Express!"</li>
        </ul>
    </div>

    <div class="alert alert-danger" role="alert">
        <strong>‚õî Para detener el servidor:</strong> Presiona <code class="language-bash">Ctrl+C</code> en la terminal
        donde est√° corriendo.
    </div>

    <h2 class="mb-4 text-primary">3. Aplicaci√≥n Real - Lista de Tareas (ToDo App)</h2>

    <h3 class="mb-4 text-primary">3.1 Clonar y configurar una aplicaci√≥n existente</h3>
    <p>Ahora vamos a trabajar con una aplicaci√≥n m√°s completa: un gestor de tareas.</p>

    <ol>
        <li>Primero, para el servidor anterior si a√∫n est√° corriendo (Ctrl+C).</li>

        <li>Vuelve a tu directorio home e instala Git si no lo tienes:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">cd ~
sudo apt install -y git</code></pre>
            </div>
        </li>

        <li>Clona el repositorio de la aplicaci√≥n:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">git clone https://github.com/bezkoder/nodejs-express-mysql.git
cd nodejs-express-mysql</code></pre>
            </div>
            <div class="alert alert-info mt-2">
                <strong>¬øQu√© es clonar?</strong> Descargar una copia completa de un proyecto desde GitHub.
            </div>
        </li>

        <li>Examina el contenido del directorio:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">ls -la</code></pre>
            </div>
            Ver√°s archivos como <code class="language-bash">package.json</code>, <code
                class="language-bash">server.js</code>, y carpetas como <code class="language-bash">app/</code>.
        </li>

        <li>Instala todas las dependencias del proyecto. <strong>Este paso puede tardar varios minutos</strong>, ten
            paciencia:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">npm install</code></pre>
            </div>
            <div class="alert alert-info mt-2">
                <strong>¬øQu√© hace esto?</strong> Lee el archivo <code class="language-bash">package.json</code> y
                descarga todas las librer√≠as
                que la aplicaci√≥n necesita.
            </div>
        </li>

        <li>Examina el archivo <code class="language-bash">package.json</code> para ver las dependencias:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">cat package.json</code></pre>
            </div>
        </li>
    </ol>

    <h3 class="mb-4 text-primary">3.2 Configurar la Base de Datos MySQL</h3>
    <p>Esta aplicaci√≥n necesita una base de datos MySQL para funcionar.</p>

    <ol>
        <li>Instala MySQL Server:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">sudo apt install -y mariadb-server</code></pre>
            </div>
        </li>

        <li>Inicia el servicio MySQL:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">sudo systemctl start mariadb
sudo systemctl enable mariadb</code></pre>
            </div>
        </li>

        <li>Accede a MySQL como root:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">sudo mysql -u root</code></pre>
            </div>
        </li>

        <li>Dentro de MySQL, crea una base de datos y un usuario para la aplicaci√≥n:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-sql">CREATE DATABASE testdb;
CREATE USER 'testuser'@'localhost' IDENTIFIED BY 'testpassword';
GRANT ALL PRIVILEGES ON testdb.* TO 'testuser'@'localhost';
FLUSH PRIVILEGES;
EXIT;</code></pre>
            </div>
        </li>

        <li>Configura la conexi√≥n en la aplicaci√≥n. Edita el archivo de configuraci√≥n:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">nano app/config/db.config.js</code></pre>
            </div>
            Verifica que contenga:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-javascript">module.exports = {
  HOST: "localhost",
  USER: "testuser",
  PASSWORD: "testpassword",
  DB: "testdb"
};</code></pre>
            </div>
            Guarda los cambios.
        </li>
    </ol>

    <h3 class="mb-4 text-primary">3.3 Ejecutar la aplicaci√≥n</h3>
    <ol>
        <li>Inicia la aplicaci√≥n:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">node server.js</code></pre>
            </div>
            Deber√≠as ver mensajes indicando que el servidor est√° corriendo en el puerto 8080.
        </li>

        <li>Accede desde tu navegador a:
            <pre><code class="language-bash">http://IP-DE-TU-SERVIDOR:8080</code></pre>
        </li>

        <li>Prueba la API con diferentes endpoints. Abre otra terminal (sin cerrar la del servidor) y ejecuta, recuerda
            cambiar la IP por la de tu servidor, <strong>si tienes errores pasa al paso siguiente</strong>:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash"># Crear un tutorial 0: Node.js Tutorial
curl -X POST http://localhost:8080/api/tutorials -H "Content-Type: application/json" -d '{"title":"Node.js Tutorial","description":"Aprendiendo Node.js"}'

# Tutorial 1: Node.js B√°sico
curl -X POST http://localhost:8080/api/tutorials -H "Content-Type: application/json" -d '{"title":"Node.js B√°sico","description":"Introducci√≥n a Node.js y JavaScript del lado del servidor"}'

# Tutorial 2: Express Framework
curl -X POST http://localhost:8080/api/tutorials -H "Content-Type: application/json" -d '{"title":"Express Framework","description":"Creando APIs REST con Express"}'

# Tutorial 3: Bases de Datos
curl -X POST http://localhost:8080/api/tutorials -H "Content-Type: application/json" -d '{"title":"MySQL con Node.js","description":"Conectando Node.js con bases de datos MySQL"}'

# Tutorial 4: Autenticaci√≥n
curl -X POST http://localhost:8080/api/tutorials -H "Content-Type: application/json" -d '{"title":"Autenticaci√≥n JWT","description":"Implementando autenticaci√≥n con JSON Web Tokens"}'

# Tutorial 5: PM2
curl -X POST http://localhost:8080/api/tutorials -H "Content-Type: application/json" -d '{"title":"Gesti√≥n con PM2","description":"Administrando aplicaciones Node.js en producci√≥n"}'

# Tutorial 6: Docker
curl -X POST http://localhost:8080/api/tutorials -H "Content-Type: application/json" -d '{"title":"Node.js en Docker","description":"Contenedorizaci√≥n de aplicaciones Node.js"}'

# Tutorial 7: Testing
curl -X POST http://localhost:8080/api/tutorials -H "Content-Type: application/json" -d '{"title":"Testing con Jest","description":"Pruebas unitarias e integraci√≥n en Node.js"}'

# Tutorial 8: WebSockets
curl -X POST http://localhost:8080/api/tutorials -H "Content-Type: application/json" -d '{"title":"WebSockets en tiempo real","description":"Comunicaci√≥n bidireccional con Socket.io"}'

# Listar todos los tutoriales
curl http://localhost:8080/api/tutorials

# Obtener un tutorial espec√≠fico (ID 1)
curl http://localhost:8080/api/tutorials/1

# Actualizar un tutorial (ID 2)
curl -X PUT http://localhost:8080/api/tutorials/2 -H "Content-Type: application/json" -d '{"title":"Express Avanzado","description":"T√©cnicas avanzadas con Express.js","published":true}'

# Eliminar un tutorial (ID 2)
curl -X DELETE http://localhost:8080/api/tutorials/2

# Eliminar todos los tutoriales
curl -X DELETE http://localhost:8080/api/tutorials
</code></pre>
            </div>

            <div class="alert alert-info mt-3">
                <p><strong>¬øQu√© hace curl?</strong> Es una herramienta para hacer peticiones HTTP desde la terminal.</p>
            </div>
            <div class="alert alert-danger mt-2">
                <p><strong>Posiblemente de un error</strong>, la tabla tutorials no se cre√≥.</p>
            </div>
        </li>
        <li>Dentro de MySQL, crea una tabla, en la base de datos testdb:
            <pre><code class="language-sql">sudo mysql -u root</code></pre>
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-sql">USE testdb;
CREATE TABLE IF NOT EXISTS tutorials (
  id INT AUTO_INCREMENT PRIMARY KEY,
  title VARCHAR(255),
  description VARCHAR(255),
  published BOOLEAN DEFAULT false,
  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

EXIT;</code></pre>
            </div>
        </li>
        <li>Reinicia el servidor:
            <pre><code class="language-bash">node server.js</code></pre>
            <div class="alert alert-success mt-2">
                <p>Vuelve al punto 3.3 y prueba la API con diferentes endpoints.</p>
            </div>
        </li>
    </ol>

    <div class="alert alert-warning" role="alert">
        <strong>üîí Seguridad AWS:</strong> Abre tambi√©n el puerto 8080 en tu grupo de seguridad.
    </div>

    <div class="alert alert-warning" role="alert">
        <strong>üì∏ Tarea:</strong> Capturas de pantalla mostrando:
        <ul>
            <li>El servidor corriendo en la terminal</li>
            <li>Los resultados de los comandos curl (crear y listar tutoriales)</li>
        </ul>
    </div>

    <h2 class="mb-4 text-primary">4. Gesti√≥n de Procesos con PM2</h2>
    <p>Hasta ahora, si cierras la terminal, el servidor se detiene. PM2 es un gestor de procesos que mantiene tu
        aplicaci√≥n corriendo en segundo plano y la reinicia autom√°ticamente si falla.</p>

    <h3 class="mb-4 text-primary">4.1 Instalar y configurar PM2</h3>
    <ol>
        <li>Det√©n el servidor actual (Ctrl+C).</li>

        <li>Instala PM2 globalmente:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">sudo npm install -g pm2</code></pre>
            </div>
        </li>

        <li>Inicia tu aplicaci√≥n con PM2:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">pm2 start server.js --name "todo-app"</code></pre>
            </div>
            <div class="alert alert-info mt-2">
                <code class="language-bash">--name "todo-app"</code> le da un nombre f√°cil de
                recordar a tu aplicaci√≥n.
            </div>
        </li>

        <li>Verifica que la aplicaci√≥n est√° corriendo:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">pm2 list</code></pre>
            </div>
            Deber√≠as ver tu aplicaci√≥n en la lista con estado "online".
        </li>

        <li>Prueba que puedes cerrar la terminal y la aplicaci√≥n sigue funcionando:
            <ul>
                <li>Accede de nuevo a <code class="language-bash">http://IP-DE-TU-SERVIDOR:8080/api/tutorials</code>
                </li>
                <li>Cierra tu sesi√≥n SSH</li>
                <li>Vuelve a conectarte y verifica que la app sigue corriendo</li>
            </ul>
        </li>

        <li>Comandos √∫tiles de PM2:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash"># Ver logs en tiempo real
pm2 logs todo-app

# Reiniciar la aplicaci√≥n
pm2 restart todo-app

# Detener la aplicaci√≥n
pm2 stop todo-app

# Eliminar la aplicaci√≥n de PM2
pm2 delete todo-app

# Ver informaci√≥n detallada
pm2 show todo-app</code></pre>
            </div>
        </li>

        <li>Configura PM2 para que se inicie autom√°ticamente al arrancar el servidor:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash"># El primer comando te mostrar√° un comando adicional que debes ejecutar (c√≥pialo y ejec√∫talo).
pm2 startup
# El segundo guarda la lista de aplicaciones actuales.
pm2 save</code></pre>
            </div>
        </li>
    </ol>

    <div class="alert alert-warning" role="alert">
        <strong>üì∏ Tarea:</strong> Captura de pantalla mostrando:
        <ul>
            <li>La salida de <code class="language-bash">pm2 list</code> con tu aplicaci√≥n corriendo</li>
            <li>La salida de <code class="language-bash">pm2 logs todo-app</code></li>
        </ul>
    </div>

    <h2 class="mb-4 text-primary">5. Proxy Inverso con Nginx (Opcional pero Recomendado)</h2>
    <p>En producci√≥n, es una buena pr√°ctica poner Nginx delante de Node.js. Nginx manejar√° las peticiones HTTP y las
        redirigir√° a Node.js.</p>

    <h3 class="mb-4 text-primary">5.1 Configurar Nginx como proxy inverso</h3>
    <ol>
        <li>Instala Nginx:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">sudo apt install -y nginx</code></pre>
            </div>
        </li>

        <li>Crea un archivo de configuraci√≥n para tu aplicaci√≥n:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">sudo nano /etc/nginx/sites-available/todo-app</code></pre>
            </div>
            A√±ade el siguiente contenido:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-nginx">server {
    listen 80;
    server_name tu-dominio.com;  # O tu IP

    location / {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}</code></pre>
            </div>
        </li>

        <li>Habilita el sitio creando un enlace simb√≥lico:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">sudo ln -s /etc/nginx/sites-available/todo-app /etc/nginx/sites-enabled/</code></pre>
            </div>
        </li>

        <li>Desactiva el sitio por defecto de Nginx (opcional):
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">sudo rm /etc/nginx/sites-enabled/default</code></pre>
            </div>
        </li>

        <li>Verifica que la configuraci√≥n es correcta:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">sudo nginx -t</code></pre>
            </div>
        </li>

        <li>Reinicia Nginx:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">sudo systemctl restart nginx</code></pre>
            </div>
        </li>

        <li>Ahora puedes acceder a tu aplicaci√≥n directamente por HTTP (puerto 80):
            <pre><code class="language-bash">http://IP-DE-TU-SERVIDOR/api/tutorials</code></pre>
            ¬°Ya no necesitas especificar el puerto 8080!
        </li>
    </ol>

    <div class="alert alert-info" role="alert">
        <strong>üí° Ventajas del proxy inverso:</strong>
        <ul>
            <li>Nginx maneja SSL/TLS (HTTPS) de forma m√°s eficiente</li>
            <li>Puedes servir archivos est√°ticos directamente desde Nginx</li>
            <li>Mejor rendimiento bajo carga alta</li>
            <li>Puedes tener m√∫ltiples aplicaciones Node.js con un solo Nginx</li>
        </ul>
    </div>

    <h2 class="mb-4 text-primary">6. An√°lisis y Troubleshooting</h2>

    <h3 class="mb-4 text-primary">6.1 Trabajar con logs</h3>
    <ol>
        <li>Ver los logs de PM2 en tiempo real:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">pm2 logs todo-app</code></pre>
            </div>
            Mant√©n este comando corriendo y desde tu navegador accede a la aplicaci√≥n. Ver√°s las peticiones en tiempo
            real.
        </li>

        <li>Ver logs de Nginx:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash"># Logs de acceso
sudo tail -f /var/log/nginx/access.log

# Logs de errores
sudo tail -f /var/log/nginx/error.log</code></pre>
            </div>
        </li>

        <li>Simula un error: intenta acceder a una ruta que no existe:
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash">curl http://localhost:8080/api/noexiste</code></pre>
            </div>
            Observa el error en los logs.
        </li>
    </ol>

    <h3 class="mb-4 text-primary">6.2 Depuraci√≥n de problemas comunes</h3>
    <p>Practica resolver estos problemas simulados:</p>

    <ol>
        <li><strong>Problema 1:</strong> El servidor no inicia.
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash"># Verifica si el puerto est√° siendo usado
sudo ss -tulpn | grep :8080

# Verifica los logs de PM2
pm2 logs todo-app --err</code></pre>
            </div>
        </li>

        <li><strong>Problema 2:</strong> No puedes conectarte desde fuera.
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash"># Verifica que el firewall no est√© bloqueando - SOLO PARA AWS
sudo ufw status

# Verifica que la aplicaci√≥n est√© escuchando en todas las interfaces
sudo ss -tulpn | grep :8080</code></pre>
            </div>
        </li>

        <li><strong>Problema 3:</strong> La aplicaci√≥n se reinicia constantemente.
            <div class="position-relative">
                <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2"
                    onclick="copiarCodigo(this)">Copiar</button>
                <pre><code class="language-bash"># Revisa los logs para ver el error
pm2 logs todo-app

# Verifica el estado
pm2 list</code></pre>
            </div>
        </li>
    </ol>

    <h2 class="mb-4 text-primary">Cuestionario Final</h2>
    <p>Responde a estas preguntas al final del documento:</p>

    <ol>
        <li>¬øQu√© es npm y cu√°l es su funci√≥n principal?</li>

        <li>¬øQu√© archivo contiene la lista de dependencias de un proyecto Node.js?</li>

        <li>Explica la diferencia entre instalar un paquete con <code class="language-bash">npm install express</code> y
            con
            <code class="language-bash">npm install -g express</code>.
        </li>

        <li>¬øPor qu√© es recomendable usar PM2 en producci√≥n en lugar de ejecutar <code
                class="language-bash">node app.js</code>
            directamente?</li>

        <li>¬øQu√© ventajas ofrece usar Nginx como proxy inverso delante de Node.js?</li>

        <li>Si tu aplicaci√≥n no arranca y PM2 muestra el estado "errored", ¬øqu√© comando usar√≠as para ver los
            logs de error?</li>

        <li>En el c√≥digo de la primera aplicaci√≥n (<code class="language-bash">app.js</code>), ¬øqu√© hace
            exactamente la l√≠nea
            <code class="language-bash">app.listen(3000)</code>?
        </li>

        <li>Cuando ejecutas <code class="language-bash">npm install</code>, ¬øqu√© carpeta se crea y qu√©
            contiene?</li>
    </ol>

    <h2 class="mb-4 text-primary">Entrega de la Pr√°ctica</h2>
    <div class="alert alert-success" role="alert">
        <strong>üì¶ Contenido a entregar:</strong>
        <ul>
            <li>Documento Google Docs con todas las capturas que consideres relevantes, adem√°s puedes a√±adir informaci√≥n
                adicional para que sea m√°s entendible.</li>
            <li>Respuestas al cuestionario final</li>
        </ul>
    </div>

    <div class="alert alert-info" role="alert">
        <strong>üí° Consejos finales:</strong>
        <ul>
            <li>Lee los mensajes de error completos, suelen indicar exactamente qu√© falla</li>
            <li>Usa <code class="language-bash">pm2 logs</code> cuando algo no funcione como esperabas</li>
            <li>Verifica siempre que los puertos est√©n abiertos en el firewall/grupo de seguridad</li>
            <li>La documentaci√≥n oficial de Express es excelente: <a href="https://expressjs.com"
                    target="_blank">https://expressjs.com</a></li>
        </ul>
    </div>
</div>
