<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>SMX - APLICACIONES OFIMÁTICAS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- Prism.js para resaltado de sintaxis -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <!-- Tu archivo CSS personalizado -->
</head>

<body>
    <div class="d-flex" id="wrapper">
        <!-- Sidebar se carga aquí -->
        <div id="sidebar-wrapper"></div>
        <!-- /#sidebar-wrapper -->

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
                <div class="container-fluid">
                    <button class="btn btn-primary d-md-none" id="sidebarToggle"><i class="bi bi-list"></i></button>
                    <h5 class="ms-3 d-none d-md-block">APLICACIONES WEB</h5>
                </div>
            </nav>

            <div id="contenido" class="container-fluid mt-4">
                <h1>Bienvenido a tus Unidades</h1>
                <p>Selecciona una unidad del menú de la izquierda para ver su contenido.</p>
            </div>
        </div>
        <!-- /#page-content-wrapper -->
    </div>
    <!-- /#wrapper -->

    <script>
        // Función para inicializar los listeners del menú de 3 niveles
        function inicializarSubmenus() {
            const submenuToggles = document.querySelectorAll('.submenu-toggle');
            submenuToggles.forEach(function (toggle) {
                toggle.addEventListener('click', function (event) {
                    event.preventDefault();
                    event.stopPropagation();
                    const submenu = this.nextElementSibling;
                    if (submenu) {
                        submenu.classList.toggle('show');
                    }
                });
            });
        }

        // Cargar el menú principal y luego inicializar todo
        fetch("./nav/menu.html")
            .then((res) => res.text())
            .then((data) => {
                // 1. Carga el nav en el #sidebar-wrapper
                document.getElementById("sidebar-wrapper").innerHTML = data;

                // 2. Añadir listeners a los enlaces que cargan contenido
                const links = document.querySelectorAll("a[data-page]");
                links.forEach(link => {
                    link.addEventListener("click", function (e) {
                        e.preventDefault();
                        const page = this.getAttribute("data-page");
                        const title = this.getAttribute("data-title") || "APLICACIONES WEB";

                        fetch(page)
                            .then(res => res.text())
                            .then(html => {
                                document.getElementById("contenido").innerHTML = html;
                                document.title = title;
                                if (window.Prism) {
                                    Prism.highlightAll();
                                }
                                if (window.innerWidth < 768 && document.getElementById("wrapper").classList.contains("toggled")) {
                                    document.getElementById("wrapper").classList.remove("toggled");
                                }
                            });
                    });
                });

                // ***** LA PARTE CLAVE DE LA SOLUCIÓN *****
                // 3. AHORA que el HTML del menú está en la página, inicializamos los submenús
                inicializarSubmenus();

                // 4. Lógica para el toggle del sidebar (botón de hamburguesa)
                var sidebarToggle = document.getElementById("sidebarToggle");
                if (sidebarToggle) {
                    sidebarToggle.addEventListener("click", function (e) {
                        e.preventDefault();
                        document.getElementById("wrapper").classList.toggle("toggled");
                    });
                }

                // 5. Asegurar estado visual correcto del sidebar en desktop
                if (window.innerWidth >= 768) {
                    document.getElementById("wrapper").classList.remove("toggled");
                }
            });
    </script>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Prism.js para resaltado de sintaxis -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <!-- Script para copiar al portapapeles -->
    <script>
        function copiarCodigo(boton) {
            const codigo = boton.nextElementSibling.querySelector("code");
            const texto = codigo.innerText;
            navigator.clipboard.writeText(texto).then(() => {
                boton.innerText = "¡Copiado!";
                setTimeout(() => boton.innerText = "Copiar", 2000);
            });
        }
    </script>
</body>

</html>
